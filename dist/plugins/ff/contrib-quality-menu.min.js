/*! @name videojs-contrib-quality-menu @version 1.0.1 @license Apache-2.0 */ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsContribQualityMenu=t(e.videojs)}(this,function(e){"use strict";var t,l=(t=e)&&"object"==typeof t&&"default"in t?t:{default:t};let s=l.default.getComponent("MenuItem"),i=l.default.dom||l.default;class a extends s{constructor(e,t={}){let l=t.selected;t.selected=t.active,super(e,t);let s=e.qualityLevels();this.levels_=t.levels,this.selected_=l,this.handleQualityChange=this.handleQualityChange.bind(this),this.controlText(t.controlText),this.on(s,"change",this.handleQualityChange),this.on("dispose",()=>{this.off(s,"change",this.handleQualityChange)})}createEl(e,t,l){let s=super.createEl(e,t,l),a=i.createEl("span",{className:"vjs-quality-menu-item-sub-label",innerHTML:this.localize(this.options_.subLabel||"")});return this.subLabel_=a,s&&s.appendChild(a),s}handleClick(){this.updateSiblings_();let e=this.player().qualityLevels(),t=e.selectedIndex;for(let l=0,s=e.length;l<s;l++)l!==t&&(e[l].enabled=!1);for(let i=0,a=this.levels_.length;i<a;i++)e[this.levels_[i]].enabled=!0;-1!==t&&-1===this.levels_.indexOf(t)&&(e[t].enabled=!1)}handleQualityChange(){let e=this.player().qualityLevels(),t=this.levels_.indexOf(e.selectedIndex)>-1;this.selected(t)}selected(e){if(this.selectable){if(this.selected_){this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(this.localize("{1}, selected",this.localize(this.options_.controlText)));let t=this.player().controlBar,l=t.getChild("QualityMenuButton");e?l.removeClass("vjs-quality-menu-button-waiting"):l.addClass("vjs-quality-menu-button-waiting")}else this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(this.options_.controlText)}}updateSiblings_(){let e=this.player().qualityLevels(),t=this.player().controlBar,l=t.getChild("QualityMenuButton").items;for(let s=0,i=l.length;s<i;s++){let a=l[s],n=a.levels_.indexOf(e.selectedIndex)>-1;a.selected_=a===this,a.selected(n)}}}let n=l.default.getComponent("MenuButton"),u=function(e){return Array.from(e).some(e=>e.height)},h=function(e){return e>=2160?"4K":e>=720?"HD":""};l.default.registerComponent("QualityMenuButton",class e extends n{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-label",this.localize("Quality Levels")),this.controlText("Quality Levels"),e.options().experimentalSvgIcons||this.$(".vjs-icon-placeholder").classList.add("vjs-icon-cog"),this.setIcon("cog"),this.qualityLevels_=e.qualityLevels(),this.update=this.update.bind(this),this.hide=this.hide.bind(this),this.handleQualityChange_=this.handleQualityChange_.bind(this),this.changeHandler_=()=>{let e=this.options_.defaultResolution;for(let t=0;t<this.items.length;t++)-1!==this.items[t].options_.label.indexOf(e)&&this.items[t].handleClick()},this.on(this.qualityLevels_,"addqualitylevel",this.update),this.on(this.qualityLevels_,"removequalitylevel",this.update),this.on(this.qualityLevels_,"change",this.handleQualityChange_),this.one(this.qualityLevels_,"change",this.changeHandler_),e.on("adstart",this.hide),e.on(["adend","adtimeout"],this.update),this.update(),this.on("dispose",()=>{this.off(this.qualityLevels_,"addqualitylevel",this.update),this.off(this.qualityLevels_,"removequalitylevel",this.update),this.off(this.qualityLevels_,"change",this.handleQualityChange_),this.off(this.qualityLevels_,"change",this.changeHandler_),e.off("adstart",this.hide),e.off(["adend","adtimeout"],this.update)})}buildWrapperCSSClass(){return`vjs-quality-menu-wrapper ${super.buildWrapperCSSClass()}`}buildCSSClass(){return`vjs-quality-menu-button ${super.buildCSSClass()}`}createItems(){let e=[];if(!(this.qualityLevels_&&this.qualityLevels_.length))return e;let t;if(this.options_.useResolutionLabels&&u(this.qualityLevels_)?(t=this.groupByResolution_(),this.addClass("vjs-quality-menu-button-use-resolution")):(t=this.groupByBitrate_(),this.removeClass("vjs-quality-menu-button-use-resolution")),t.length<=1)return[];t.forEach(t=>{t.levels.length&&(t.selectable=!0,e.push(new a(this.player(),t)))});let l=new a(this.player(),{levels:Array.prototype.map.call(this.qualityLevels_,(e,t)=>t),label:"Auto",controlText:"Auto",active:!0,selected:!0,selectable:!0});return this.autoMenuItem_=l,e.push(l),e}groupByResolution_(){let e={},t=[];for(let l=0,s=this.qualityLevels_.length;l<s;l++){let i=this.qualityLevels_[l],a=this.qualityLevels_.selectedIndex===l,n=i.height;if(!n)continue;let u;if(this.options_.resolutionLabelBitrates){let o=Math.round(i.bitrate/1e3);u=`${n}p @ ${o} kbps`}else u=n+"p";if(!e[u]){let d=h(n);e[u]={levels:[],label:u,controlText:u,subLabel:d},t.push({label:u,lines:n})}a&&(e[u].active=!0),e[u].levels.push(l)}t.sort((e,t)=>t.lines-e.lines);let r=[];return t.forEach(t=>{r.push(e[t.label])}),r}groupByBitrate_(){let e=[{levels:[],label:"HD",controlText:"High Definition"},{levels:[],label:"SD",controlText:"Standard Definition"}];for(let t=0,l=this.qualityLevels_.length;t<l;t++){let s=this.qualityLevels_[t],i=this.qualityLevels_.selectedIndex===t,a;a=s.bitrate<this.options_.sdBitrateLimit?e[1]:e[0],i&&(a.active=!0),a.levels.push(t)}return e[0].levels.length&&e[1].levels.length?e:[]}handleQualityChange_(){let e=this.qualityLevels_[this.qualityLevels_.selectedIndex],t=this.options_.useResolutionLabels&&u(this.qualityLevels_),l="";e&&(t?l=h(e.height):e.bitrate>=this.options_.sdBitrateLimit&&(l="HD")),"HD"===l?(this.addClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")):"4K"===l?(this.removeClass("vjs-quality-menu-button-HD-flag"),this.addClass("vjs-quality-menu-button-4K-flag")):(this.removeClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")),this.autoMenuItem_&&(this.autoMenuItem_.manuallySelected_&&e?this.autoMenuItem_.subLabel_.innerHTML=this.localize(l):this.autoMenuItem_.subLabel_.innerHTML="")}});var o="1.0.1";let d={sdBitrateLimit:2e6,useResolutionLabels:!0,resolutionLabelBitrates:!1,defaultResolution:"none"},r=(e,t)=>{e.addClass("vjs-quality-menu");let l=e.getChild("controlBar"),s=l.addChild("QualityMenuButton",t,l.children_.length-2);return function(){e.removeClass("vjs-quality-menu"),l.removeChild(s),s.dispose()}},c=function(e,t){if(void 0!==e.qualityLevels){e.qualityLevels();let l=()=>{};e.ready(()=>{l=r(e,t),e.on("loadstart",()=>{l(),l=r(e,t)})}),e.qualityMenu=()=>{},e.qualityMenu.VERSION=o}},v=function(e){c(this,l.default.obj.merge(d,e))};return l.default.registerPlugin("qualityMenu",v),v.VERSION=o,v});